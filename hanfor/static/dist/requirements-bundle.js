!function(e){function t(t){for(var a,o,s=t[0],l=t[1],c=t[2],d=0,f=[];d<s.length;d++)o=s[d],r[o]&&f.push(r[o][0]),r[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(u&&u(t);f.length;)f.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,s=1;s<n.length;s++){var l=n[s];0!==r[l]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={5:0},i=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;i.push([222,0]),n()}({217:function(e,t){const n={":AND:":1,":OR:":1},a={":AND:":1,":OR:":1},r={},i={"(":1,")":1},o={":AND:":3,":OR:":2};class s{constructor(e){this.left=!1,this.value=e,this.right=!1,this.col_target=-1,this.update_target()}update_target(){const e=this.value.indexOf(":COL_INDEX_");if(e>=0){const t=parseInt(this.value.substring(e+11,e+13));t>=0&&(this.value=this.value.substring(e+14),this.col_target=t)}}evaluate(e,t){return function e(t,n,a){if(void 0===t)return!0;if(!1===t.left&&!1===t.right){let e="";if(-1!==t.col_target)e=n[t.col_target];else for(let t=0;t<a.length;t++)a[t]&&(e+=n[t]+" ");const r=t.value.indexOf(":NOT:");return r>=0?!l(t.value.substring(r+5),e):l(t.value,e)}let r=e(t.left,n,a);let i=e(t.right,n,a);if(":AND:"===t.value)return r&&i;if(":OR:"===t.value)return r||i}(this,e,t)}static is_search_string(e){return!(e in i||e in n)}static to_string(e){let t="";return!1!==e.left&&(t+=s.to_string(e.left)+" "),t+=e.value,!1!==e.right&&(t+=" "+s.to_string(e.right)),t}static peek(e){return e[e.length-1]}static searchArrayToTree(e){let t=[],i=[];for(let l=0,c=e.length;l<c;l++){const c=e[l];if(s.is_search_string(c))t.push(new s(c));else if(c in n){for(;i.length;){const e=s.peek(i);if(!(e in n&&(c in a&&o[c]<=o[e]||c in r&&o[c]<o[e])))break;{let e=t.pop(),n=t.pop(),a=new s(i.pop());a.left=n,a.right=e,t.push(a)}}i.push(c)}else if("("===c)i.push(c);else{if(")"!==c)throw"Error: Token unknown: "+c;{let e=!1;for(;i.length;){const n=i.pop();if("("===n){e=!0;break}{let e=t.pop(),a=t.pop(),r=new s(n);r.left=a,r.right=e,t.push(r)}}if(!e)throw"Error: parentheses mismatch."}}}for(;i.length;){const e=i.pop();if("("===e||")"===e)throw"Error: Parentheses mismatch.";let n=t.pop(),a=t.pop(),r=new s(e);r.left=a,r.right=n,t.push(r)}return 0===t.length&&t.push(new s("")),t[0]}static awesomeQuerySplitt0r(e,t){let a=e.split(/(:OR:|:AND:|\(|\))/g);if(a=a.filter(String),void 0!==t)for(let e=0,r=a.length;e<r;e++)a[e]in n||a[e]in i||(a[e]=":COL_INDEX_"+("00"+t).slice(-2)+":"+a[e]);return a}static fromQuery(e="",t){return s.searchArrayToTree(s.awesomeQuerySplitt0r(e,t))}}function l(e,t){return e=e.startsWith('""')&&e.endsWith('""')?"^\\s*"+e.substr(2,e.length-4)+"\\s*$":e.replace(/([^\\])?\"/g,"$1\\b"),new RegExp(e,"i").test(t)}e.exports={SearchNode:s}},222:function(e,t,n){(function(e){n(17),n(10),n(15),n(14),n(20),n(13),n(149),n(12);const{SearchNode:t}=n(217);let a=n(157),{Textcomplete:r,Textarea:i}=n(156),o=new a([],{}),s=["","has_formalization"],l=["","Todo","Review","Done"],c=[""],u=[""],d=[!0,!0,!0,!0,!0,!0],f=[],p=JSON.parse(search_query),g={},h=[],m=sessionStorage.getItem("req_search_string"),_=sessionStorage.getItem("filter_status_string"),v=sessionStorage.getItem("filter_tag_string"),b=sessionStorage.getItem("filter_type_string"),y=void 0,w=void 0;function q(){m=e("#search_bar").val().trim(),sessionStorage.setItem("req_search_string",m),y=t.fromQuery(m)}function k(){function n(e,n,a){return n.length>0&&(e.length>0&&(e=e.concat([":AND:"])),e=e.concat(function(e){return["("].concat(e,[")"])}(t.awesomeQuerySplitt0r(n,a)))),e}f=[],_=e("#status-filter-input").val(),v=e("#tag-filter-input").val(),b=e("#type-filter-input").val(),sessionStorage.setItem("filter_status_string",_),sessionStorage.setItem("filter_tag_string",v),sessionStorage.setItem("filter_type_string",b),f=n(f=n(f=n(f,b,4),v,5),_,6),w=t.searchArrayToTree(f)}function O(e){let t=[];return e.rows({selected:!0}).every(function(){let e=this.data();t.push(e.id)}),t}function x(){e(".requirement_var_group").each(function(){e(this).hide(),e(this).removeClass("type-error")}),e(".formalization_card").each(function(t){const n=e(this).attr("title"),a=e("#requirement_scope"+n).val(),r=e("#requirement_pattern"+n).val();let i=e("#formalization_heading"+n),o=e("#requirement_var_group_p"+n),s=e("#requirement_var_group_q"+n),l=e("#requirement_var_group_r"+n),c=e("#requirement_var_group_s"+n),u=e("#requirement_var_group_t"+n),d=e("#requirement_var_group_u"+n);if(n in h)for(let t=0;t<h[n].length;t++)e("#formalization_var_"+h[n][t]+n).addClass("type-error"),i.addClass("type-error-head");else i.removeClass("type-error-head");switch(a){case"BEFORE":case"AFTER":o.show();break;case"BETWEEN":case"AFTER_UNTIL":o.show(),s.show()}switch(r){case"Absence":case"Universality":case"Existence":case"BoundedExistence":l.show();break;case"Invariant":case"Precedence":case"Response":case"MinDuration":case"MaxDuration":case"BoundedRecurrence":l.show(),c.show();break;case"PrecedenceChain1-2":case"PrecedenceChain2-1":case"ResponseChain1-2":case"ResponseChain2-1":case"BoundedResponse":case"BoundedInvariance":case"TimeConstrainedInvariant":l.show(),c.show(),u.show();break;case"ConstrainedChain":case"TimeConstrainedMinDuration":case"ConstrainedTimedExistence":l.show(),c.show(),u.show(),d.show();break;case"NotFormalizable":o.hide(),s.hide()}})}function C(){e(".formalization_card").each(function(t){const n=e(this).attr("title");let a="";const r=e("#requirement_scope"+n).find("option:selected").text().replace(/\s\s+/g," "),i=e("#requirement_pattern"+n).find("option:selected").text().replace(/\s\s+/g," ");"None"!==r&&"None"!==i&&(a=r+", "+i+".");let o=e("#formalization_var_p"+n).val(),s=e("#formalization_var_q"+n).val(),l=e("#formalization_var_r"+n).val(),c=e("#formalization_var_s"+n).val(),u=e("#formalization_var_t"+n).val(),d=e("#formalization_var_u"+n).val();o.length>0&&(a=a.replace(/{P}/g,o)),s.length>0&&(a=a.replace(/{Q}/g,s)),l.length>0&&(a=a.replace(/{R}/g,l)),c.length>0&&(a=a.replace(/{S}/g,c)),u.length>0&&(a=a.replace(/{T}/g,u)),d.length>0&&(a=a.replace(/{U}/g,d)),e("#current_formalization_textarea"+n).val(a)}),e("#requirement_modal").data({unsaved_changes:!0,updated_formalization:!0})}function z(){e(".formalization_selector").change(function(){x(),C()}),e(".reqirement-variable, .req_var_type").change(function(){C()}),e(".delete_formalization").confirmation({rootSelector:".delete_formalization"}).click(function(){!function(t){let n=e(".modal-content");n.LoadingOverlay("show");const a=e("#requirement_id").val();e.post("api/req/del_formalization",{requirement_id:a,formalization_id:t},function(t){n.LoadingOverlay("hide",!0),!1===t.success?alert(t.errormsg):e("#formalization_accordion").html(t.html)}).done(function(){x(),C(),z(),S(),A()})}(e(this).attr("name"))})}function S(){e(".reqirement-variable").each(function(t){let n=new i(this),a=new r(n,{dropdown:{maxCount:10}});a.register([{match:/(^|\s|[!=&\|>]+)(\w+)$/,search:function(e,t){include_elems=function(e){return o.search(e)}(e),result=[];for(let e=0;e<Math.min(10,include_elems.length);e++)result.push(u[include_elems[e]]);t(result)},replace:function(e){return"$1"+e+" "}}]),e(this).on("blur click",function(e){a.dropdown.deactivate(),e.preventDefault()})})}function T(t){if(-1===t)return void alert("Requirement not found.");let n=e("#requirements_table").DataTable().row(t).data(),r=e(".modal-content");e("#requirement_modal").modal("show"),r.LoadingOverlay("show"),e("#formalization_accordion").html(""),e("#requirement_tag_field").data("bs.tokenfield").$input.autocomplete({source:s}),e.get("api/req/get",{id:n.id,row_idx:t},function(n){e("#requirement_id").val(n.id),e("#modal_associated_row_index").val(t),u=n.available_vars,h=n.type_inference_errors,o=new a(u,{shouldSort:!0,threshold:.6,location:0,distance:100,maxPatternLength:12,minMatchCharLength:1,keys:void 0}),e("#requirement_modal_title").html(n.id+": "+n.type),e("#description_textarea").text(n.desc),e("#add_guess_description").text(n.desc),e("#formalization_accordion").html(n.formalizations_html),e("#requirement_scope").val(n.scope),e("#requirement_pattern").val(n.pattern),e("#requirement_tag_field").tokenfield("setTokens",n.tags),e("#requirement_status").val(n.status);let r=e("#csv_content_accordion");r.html(""),r.collapse("hide");let i=n.csv_data;for(const e in i)if(i.hasOwnProperty(e)){const t=i[e];r.append("<p><strong>"+e+":</strong>"+t+"</p>")}!1===n.success&&alert("Could Not load the Requirement: "+n.errormsg)}).done(function(){x(),S(),z(),e("#requirement_tag_field").on("tokenfield:createtoken",function(t){let n=e(this).tokenfield("getTokens");e.each(n,function(e,n){n.value===t.attrs.value&&t.preventDefault()})}),e("#requirement_modal").data({unsaved_changes:!1,updated_formalization:!1}),r.LoadingOverlay("hide",!0)})}function L(){let t=e("#requirements_table").DataTable(),n=[];e.each(t.columns().visible(),function(t,a){!1===a?(e("#col_toggle_button_"+t).removeClass("btn-info").addClass("btn-secondary"),n.push(!1)):(e("#col_toggle_button_"+t).removeClass("btn-secondary").addClass("btn-info"),n.push(!0))}),d=n}function N(t){t.columns().every(function(e){e>0&&t.column(e).header().append(" ("+e+")")}),e("#save_requirement_modal").click(function(){!function(t){let n=e(".modal-content");n.LoadingOverlay("show");const a=e("#requirement_id").val(),r=e("#requirement_tag_field").val(),i=e("#requirement_status").val(),o=e("#requirement_modal").data("updated_formalization"),s=parseInt(e("#modal_associated_row_index").val());let l={};e(".formalization_card").each(function(t){let n={};n.id=e(this).attr("title"),e(this).find("select").each(function(){e(this).hasClass("scope_selector")&&(n.scope=e(this).val()),e(this).hasClass("pattern_selector")&&(n.pattern=e(this).val())}),n.expression_mapping={},e(this).find("textarea.reqirement-variable").each(function(){""!==e(this).attr("title")&&(n.expression_mapping[e(this).attr("title")]=e(this).val())}),l[n.id]=n}),e.post("api/req/update",{id:a,row_idx:s,update_formalization:o,tags:r,status:i,formalizations:JSON.stringify(l)},function(a){n.LoadingOverlay("hide",!0),!1===a.success?alert(a.errormsg):(t.row(s).data(a),e("#requirement_modal").data("unsaved_changes",!1).modal("hide"))}).done(function(){A()})}(t)}),e("#search_bar").keypress(function(e){13===e.which&&(q(),t.draw())}),e("#type-filter-input").autocomplete({minLength:0,source:c,delay:100}),e("#status-filter-input").autocomplete({minLength:0,source:l,delay:100}),e("#tag-filter-input").autocomplete({minLength:0,source:s,delay:100}),e("#tag-filter-input, #status-filter-input, #type-filter-input").on("focus",function(){e(this).keydown()}).on("keypress",function(e){13===e.which&&(k(),t.draw())}),e("#table-filter-toggle").click(function(){e("#tag-filter-input").autocomplete({source:s}),e("#type-filter-input").autocomplete({source:c})}),e(".clear-all-filters").click(function(){e("#status-filter-input").val("").effect("highlight",{color:"green"},500),e("#tag-filter-input").val("").effect("highlight",{color:"green"},500),e("#type-filter-input").val("").effect("highlight",{color:"green"},500),e("#search_bar").val("").effect("highlight",{color:"green"},500),k(),q(),t.draw()}),e("#gen-req-from-selection").click(function(){let n=[];t.rows({search:"applied"}).every(function(){let e=this.data();n.push(e.id)}),e("#selected_requirement_ids").val(JSON.stringify(n)),e("#generate_req_form").submit()}),e("#gen-csv-from-selection").click(function(){let n=[];t.rows({search:"applied"}).every(function(){let e=this.data();n.push(e.id)}),e("#selected_csv_requirement_ids").val(JSON.stringify(n)),e("#generate_csv_form").submit()}),e(".colum-toggle-button").on("click",function(n){n.preventDefault();let a=t.column(e(this).attr("data-column"));a.visible(!a.visible()),L()}),e(".reset-colum-toggle").on("click",function(e){e.preventDefault(),t.columns(".default-col").visible(!0),t.columns(".extra-col").visible(!1),L()}),L(),e(".select-all-button").on("click",function(n){e(this).hasClass("btn-secondary")?t.rows({page:"current"}).select():t.rows({page:"current"}).deselect(),e(".select-all-button").toggleClass("btn-secondary btn-primary")}),t.on("user-select",function(){let t=e(".select-all-button");t.removeClass("btn-primary"),t.addClass("btn-secondary ")}),e("#multi-add-tag-input, #multi-remove-tag-input").autocomplete({minLength:0,source:s,delay:100}).on("focus",function(){e(this).keydown()}).val(""),e("#multi-set-status-input").autocomplete({minLength:0,source:l,delay:100}).on("focus",function(){e(this).keydown()}).val(""),e(".apply-multi-edit").click(function(){!function(t){let n=e("body");n.LoadingOverlay("show");let a=e("#multi-add-tag-input").val().trim(),r=e("#multi-remove-tag-input").val().trim(),i=e("#multi-set-status-input").val().trim(),o=O(t);e.post("api/req/multi_update",{add_tag:a,remove_tag:r,set_status:i,selected_ids:JSON.stringify(o)},function(e){n.LoadingOverlay("hide",!0),!1===e.success?alert(e.errormsg):location.reload()})}(t)}),e(".add_top_guess_button").confirmation({rootSelector:".add_top_guess_button"}).click(function(){!function(t){let n=e("body");n.LoadingOverlay("show");let a=O(t),r=e("#top_guess_append_mode").val();e.post("api/req/multi_add_top_guess",{selected_ids:JSON.stringify(a),insert_mode:r},function(e){n.LoadingOverlay("hide",!0),!1===e.success?alert(e.errormsg):location.reload()})}(t)})}function D(t){let n=e("#requirements_table").DataTable({language:{emptyTable:"Loading data."},paging:!0,stateSave:!0,select:{style:"os",selector:"td:first-child"},pageLength:50,lengthMenu:[[10,50,100,500,-1],[10,50,100,500,"All"]],dom:'rt<"container"<"row"<"col-md-6"li><"col-md-6"p>>>',ajax:"api/req/gets",deferRender:!0,columnDefs:t,createdRow:function(t,n,a){"Heading"===n.type&&e(t).addClass("bg-primary"),"Information"===n.type&&e(t).addClass("table-info"),"Requirement"===n.type&&e(t).addClass("table-warning"),"not set"===n.type&&e(t).addClass("table-light")},infoCallback:function(t,n,a,r,i,o){var s=this.api().page.info();e("#clear-all-filters-text").html("Showing "+i+"/"+s.recordsTotal+". Clear all.");let l="Showing "+n+" to "+a+" of "+i+" entries";return l+=" (filtered from "+s.recordsTotal+" total entries)."},initComplete:function(){e("#search_bar").val(m),e("#type-filter-input").val(b),e("#tag-filter-input").val(v),e("#status-filter-input").val(_),function(t){e("#requirements_table").find("tbody").on("click","a",function(n){n.preventDefault(),T(t.row(e(n.target).parent()).index())})}(n),N(n),function(t){if(t.q.length>0){e("#status-filter-input").val(""),e("#tag-filter-input").val(""),e("#type-filter-input").val("");const n=":COL_INDEX_"+function(e){let t="00"+e;return t.substr(t.length-2)}(t.col).toString()+":"+t.q;e("#search_bar").val(n)}}(p),q(),k(),e.fn.dataTable.ext.search.push(function(e,t,n){return function(e){return y.evaluate(e,d)&&w.evaluate(e,d)}(t)}),this.api().draw()}})}function R(){let t=e("#requirement_guess_modal"),n=e("#available_guesses_cards"),a=e(".modal-content"),r=e("#requirement_id").val();function i(e){let t='<div id="available_guesses_cards" >                <div class="card">                    <div class="pl-1 pr-1">                        <p>'+e.string+'                        </p>                    </div>                    <button type="button" class="btn btn-success btn-sm add_guess"                            title="Add formalization"                            data-scope="'+e.scope+'"                            data-pattern="'+e.pattern+"\"                            data-mapping='"+JSON.stringify(e.mapping)+"'>                        <strong>+ Add this formalization +</strong>                    </button>                </div>            </div>";n.append(t)}t.modal({keyboard:!1}),t.modal("show"),a.LoadingOverlay("show"),n.html(""),e.post("api/req/get_available_guesses",{requirement_id:r},function(e){if(!1===e.success)alert(e.errormsg);else for(let t=0;t<e.available_guesses.length;t++)i(e.available_guesses[t])}).done(function(){e(".add_guess").click(function(){!function(t,n,a){let r=e(".modal-content");r.LoadingOverlay("show");let i=e("#requirement_id").val();e.post("api/req/add_formalization_from_guess",{requirement_id:i,scope:t,pattern:n,mapping:JSON.stringify(a)},function(t){r.LoadingOverlay("hide",!0),!1===t.success?alert(t.errormsg):e("#formalization_accordion").append(t.html)}).done(function(){x(),C(),z(),S(),A()})}(e(this).data("scope"),e(this).data("pattern"),e(this).data("mapping"))}),a.LoadingOverlay("hide",!0)})}function I(){let t=[{orderable:!1,className:"select-checkbox",targets:[0],data:null,defaultContent:""},{targets:[1],data:"pos"},{targets:[2],data:"id",render:function(e,t,n,a){return result='<a href="#">'+e+"</a>",result}},{targets:[3],data:"desc"},{targets:[4],data:"type",render:function(e,t,n,a){return c.indexOf(e)<=-1&&c.push(e),e}},{targets:[5],data:"tags",render:function(t,n,a,r){return result="",e(t).each(function(e,t){var n;t.length>0&&(result+='<span class="badge" style="background-color: '+(n=t,g.hasOwnProperty(n)?g[n]:"#5bc0de")+'">'+t+"</span></br>",s.indexOf(t)<=-1&&s.push(t))}),a.formal.length>0&&(result+='<span class="badge badge-success">has_formalization</span></br>'),result}},{targets:[6],data:"status",render:function(e,t,n,a){return result='<span class="badge badge-info">'+e+"</span></br>",result}},{targets:[7],data:"formal",render:function(t,n,a,r){return result="",a.formal.length>0&&e(t).each(function(e,t){t.length>0&&(result+="<p>"+t+"</p>")}),result}}];e.get("api/table/colum_defs","",function(e){const n=e.col_defs.length;for(let a=0;a<n;a++)t.push({targets:[parseInt(e.col_defs[a].target)],data:e.col_defs[a].csv_name,visible:!1,searchable:!0})}).done(function(){D(t)})}function E(){let t=e("#requirement_modal");e("#requirement_tag_field").tokenfield({autocomplete:{source:s,delay:100},showAutocompleteOnFocus:!0}).change(function(e){t.data("unsaved_changes",!0)}),e("#requirement_status").change(function(){e("#requirement_modal").data("unsaved_changes",!0)}),t.on("hide.bs.modal",function(t){!function(t){!0===e("#requirement_modal").data("unsaved_changes")&&!0!==confirm("You have unsaved changes, do you really want to close?")&&t.preventDefault()}(t)}),e(document).keyup(function(t){if(e(".modal:visible").length&&27===t.keyCode){let t=e("input[type=text], textarea, select").filter(":focus");0===t.length?e("#requirement_guess_modal:visible").length?e("#requirement_guess_modal").modal("hide"):e("#requirement_modal").modal("hide"):t.each(function(t){e(this).blur()})}}),t.on("hidden.bs.modal",function(t){e("#requirement_tag_field").val(""),e("#requirement_tag_field-tokenfield").val("")}),e("#add_formalization").click(function(){!function(){let t=e(".modal-content");t.LoadingOverlay("show");const n=e("#requirement_id").val();e.post("api/req/new_formalization",{id:n},function(n){t.LoadingOverlay("hide",!0),!1===n.success?alert(n.errormsg):e("#formalization_accordion").append(n.html)}).done(function(){x(),C(),z(),S(),A()})}()}),e("#add_gussed_formalization").click(function(){R()}),e(".modal").on("hidden.bs.modal",function(t){e(".modal:visible").length&&e("body").addClass("modal-open")}),x()}function A(){e.get("api/logs/get","",function(t){e("#log_textarea").html(t)}).done(function(){e(".req_direct_link").click(function(){T(function(t){let n=-1;return e("#requirements_table").DataTable().column(2).data().filter(function(e,a){return e===t&&(n=a,!0)}),n}(e(this).data("rid")))}),e("#log_textarea").scrollTop(1e5)})}e(document).ready(function(){e.get("api/meta/get","",function(e){g=e.tag_colors}),I(),E(),A()})}).call(this,n(3))}});